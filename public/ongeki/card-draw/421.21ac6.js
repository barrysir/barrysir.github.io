"use strict";(self.webpackChunkddr_card_draw=self.webpackChunkddr_card_draw||[]).push([[421],{6243:(e,t,n)=>{n.d(t,{X_:()=>l,nl:()=>d,oM:()=>u});var c=n(8712),r=n(3180),a=n(7294),o=n(3973),s=n(3445),i=n(4538);const{Provider:l,useContextValue:d,StoreIndex:h,useStore:u}=function(e,t,n){const c=(0,o.M)(e.bind(void 0,{initialDrawing:{id:"stub",players:[],charts:[],bans:[],pocketPicks:[],protects:[],winners:[]}})),r=(0,a.createContext)(c),i=new Map,l=()=>(0,a.useContext)(r);return{Provider:t=>{const[n]=(0,a.useState)((()=>(0,o.M)(e.bind(void 0,t))));return(0,a.useEffect)((()=>{const e=t.initialDrawing.id;return i.set(e,n),()=>{i.delete(e)}}),[]),(0,a.createElement)(r.Provider,{value:n},t.children)},useContextValue:function(e,t){const n=l();return e?(0,s.oR)(n,e,t):(0,s.oR)(n)},StoreIndex:i,useStore:l}}(((e,t,n)=>({...e.initialDrawing,updateDrawing:t,incrementPriorityPlayer(){t((e=>{let t=e.priorityPlayer;return t?(t+=1,t>=e.players.length+1&&(t=void 0)):t=1,{priorityPlayer:t}}))},resetChart(e){t((t=>({bans:t.bans.filter((t=>t.chartId!==e)),protects:t.protects.filter((t=>t.chartId!==e)),pocketPicks:t.pocketPicks.filter((t=>t.chartId!==e)),winners:t.pocketPicks.filter((t=>t.chartId!==e))})))},redrawChart(e){const a=(0,c.cK)(i.g.getState().gameData,{...r.Q.getState(),chartCount:1},n().charts.filter((t=>t.id!=e))).charts[0];t((t=>({charts:t.charts.map((t=>t.id===e?(a.id=e,a):t))})))},redrawAllCharts(){const e=n(),a=new Set([...e.pocketPicks.map((e=>e.chartId)),...e.protects.map((e=>e.chartId))]),o=e.charts.filter((e=>a.has(e.id))),s=(0,c.ii)(i.g.getState().gameData,{...r.Q.getState(),chartCount:n().charts.length-o.length});t((()=>({charts:[...o,...s.charts],bans:[]})))},handleBanProtectReplace(e,c,a,o){const s=n(),i=s.charts.slice(),l=function(e){switch(e){case"ban":return"bans";case"protect":return"protects";case"pocket":return"pocketPicks"}}(e),d=s[l].slice();if(r.Q.getState().orderByAction){const n=i.findIndex((e=>e.id===c)),[r]=i.splice(n,1);if("ban"===e){const e=i.length;i.splice(e,0,r)}else{const e=s.protects.length+s.pocketPicks.length;i.splice(e,0,r)}t({charts:i})}const h=d.findIndex((e=>e.chartId===c));h>=0?d.splice(h,1):d.push({player:a,pick:o,chartId:c}),t({[l]:d})},serializeSyncFields:()=>Object.entries(n()).reduce(((e,t)=>{let[n,c]=t;return"function"==typeof c||n.startsWith("__")||(e[n]=c),e}),{}),setWinner(e,c){const r=n().winners.slice(),a=r.findIndex((t=>t.chartId===e));a>=0&&r.splice(a,1),c&&r.push({player:c,chartId:e}),t({winners:r})}})))},8421:(e,t,n)=>{n.d(t,{P:()=>c.P});var c=n(7610)},7610:(e,t,n)=>{n.d(t,{P:()=>D});var c=n(3233),r=n(4184),a=n.n(r),o=n(7294),s=n(6248),i=n(3180),l=n(6243),d=n(8712),h=n(4538),u=n(3531),p=n(6839),g=n(8095),f=n(7391),k=n(5893);function m(e){return e.song.jacket?(0,k.jsx)("img",{src:"".concat(e.song.jacket),className:e.className,style:{height:"".concat(e.height,"px")}}):(0,k.jsx)("div",{className:e.className,children:(0,k.jsx)(g.I,{icon:f.d.MUSIC,size:e.height})})}const x={songSearch:"songSearch__SKgFq"};var C=n(3018);function v(e){let{data:t,selected:n,handleClick:c}=e;const r=t.song,{t:a}=(0,p.Y)();let o,s=!1;return"object"==typeof t.chart?o=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(u.ut,{diffClass:t.chart.diffClass})," ",(0,u.aI)(t.chart.lvl)]}):"string"==typeof t.chart?(o=a("noMatchingCharts"),s=!0):o=r.artist_translation||r.artist,(0,k.jsx)(C.s,{selected:n,disabled:s,icon:(0,k.jsx)(m,{song:r,height:26,className:x.img}),text:r.name_translation||r.name,label:o,onClick:c})}var S=n(2962);function P(e){const{isOpen:t,onSongSelect:n,onCancel:c}=e,[r,a]=(0,o.useState)(""),s=(0,i.Q)(),l=(0,h.g)((e=>e.fuzzySearch));let u=[];if(l){const e=l.search(r).filter((e=>(0,d.bz)(s,e,!0))).slice(0,30);for(const t of e){const e=t.charts.filter((e=>(0,d.P2)(s,e,!0)));for(const n of e)u.push({song:t,chart:n});e.length||u.push({song:t,chart:"none"})}u=u.slice(0,s.constrainPocketPicks?30:15)}return(0,k.jsx)(S.T,{isOpen:t,onClose:c,query:r,onQueryChange:a,onItemSelect:e=>n(e.song,"none"!==e.chart&&e.chart?(0,d.mP)(h.g.getState().gameData,e.song,e.chart):void 0),items:u,inputProps:{placeholder:"Find a song..."},className:x.songSearch,itemRenderer:(e,t)=>(0,k.jsx)(v,{data:e,selected:t.modifiers.active,handleClick:t.handleClick},"".concat(e.song.name,"-").concat("string"==typeof e.chart?e.chart:e.chart.diffClass))})}var _=n(6130),j=n(2609),y=n(7673);const b={cardLabel:"cardLabel__S1b_R",winner:"winner__R62ef"};let R=function(e){return e[e.Protect=1]="Protect",e[e.Ban=2]="Ban",e[e.Pocket=3]="Pocket",e[e.Winner=4]="Winner",e}({});function w(e){switch(e){case R.Pocket:return j.S.PRIMARY;case R.Ban:return j.S.DANGER;case R.Protect:return j.S.SUCCESS;case R.Winner:return j.S.WARNING}}function I(e){switch(e){case R.Pocket:return f.d.INHERITANCE;case R.Ban:return f.d.BAN_CIRCLE;case R.Protect:return f.d.LOCK;case R.Winner:return f.d.Crown}}function N(e){let{player:t,type:n,onRemove:c}=e;const r=(o=t,(0,l.nl)((e=>e.players[o-1]||"P".concat(o))));var o;const s=a()(b.cardLabel,{[b.winner]:n===R.Winner});return(0,k.jsx)("div",{className:s,children:(0,k.jsx)(y.V,{intent:w(n),icon:I(n),large:!0,onRemove:c,children:r})})}var W=n(2771),A=n(1478);function B(e){const{onStartPocketPick:t,onVeto:n,onProtect:c,onRedraw:r,onSetWinner:a}=e,{t:o}=(0,p.Y)();return(0,k.jsxs)(W.v,{children:[c&&(0,k.jsx)(E,{icon:f.d.LOCK,text:o("songAction.lock"),onClick:c}),t&&(0,k.jsx)(E,{icon:f.d.INHERITANCE,text:o("songAction.pocketPick"),onClick:t}),n&&(0,k.jsx)(E,{icon:f.d.BAN_CIRCLE,text:o("songAction.ban"),onClick:n}),a&&(0,k.jsx)(E,{icon:f.d.CROWN,text:o("songAction.winner"),onClick:a}),r&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(A.R,{}),(0,k.jsx)(C.s,{text:o("songAction.redraw"),icon:f.d.REFRESH,onClick:r})]})]})}function E(e){let{icon:t,text:n,onClick:c}=e;const r=(0,l.nl)((e=>e.players));return(0,k.jsx)(C.s,{icon:t,text:n,children:r.map(((e,t)=>(0,k.jsx)(C.s,{text:e||"P".concat(t+1),onClick:()=>c(t+1),icon:f.d.PERSON},t)))})}const F={chart:"chart__uhKDS",clickable:"clickable__wEg17",clickTarget:"clickTarget__uk0zq",cardCenter:"cardCenter__I1U8K",name:"name__n9rJM",nameTranslation:"nameTranslation__Yw8Wv",cardFooter:"cardFooter__bQ9F_",shockBadge:"shockBadge__irMwM",difficulty:"difficulty__eQWzH",vetoed:"vetoed__DeTm3",protected:"protected__gFnkz",replaced:"replaced__wn0Q9",hideVeto:"hideVeto__APgzc",shrink:"shrink__YveJK"},T="ja"===_.pv;function D(e){const t=(0,h.g)((e=>e.dataSetName)),{chart:n,vetoedBy:r,protectedBy:d,replacedBy:p,replacedWith:g,winner:f,actionsEnabled:m}=e,x=(0,i.Q)((e=>e.hideVetos)),[C,v]=(0,o.useState)(!1),[S,_]=(0,o.useState)(0),{name:j,nameTranslation:y,artist:b,artistTranslation:w,diffAbbr:I,diffColor:W,level:A,levelConstant:E,jacket:D}=g||n,M=!!(r||d||p);let V={};D&&(V={backgroundImage:'url("'.concat(D,'")')});const z=function(e){const[t,n,c,r]=(0,l.nl)((e=>[e.handleBanProtectReplace,e.redrawChart,e.resetChart,e.setWinner]),s.X);return(0,o.useMemo)((()=>({onVeto:t.bind(void 0,"ban",e),onProtect:t.bind(void 0,"protect",e),onReplace:t.bind(void 0,"pocket",e),onRedraw:n.bind(void 0,e),onReset:c.bind(void 0,e),onSetWinner:r.bind(void 0,e)})),[t,e,n,c,r])}(n.id);let O;m&&!f&&(M?r||(O=(0,k.jsx)(B,{onSetWinner:z.onSetWinner})):O=(0,k.jsx)(B,{onProtect:z.onProtect,onStartPocketPick:_,onVeto:z.onVeto,onRedraw:z.onRedraw,onSetWinner:z.onSetWinner}));const Q=a()(F.chart,{[F.vetoed]:r,[F.protected]:d,[F.replaced]:p,[F.clickable]:!!O||!!e.onClick,[F.hideVeto]:x});return(0,k.jsxs)("div",{className:Q,onClick:!O||C||S?e.onClick:()=>v(!0),style:V,children:[(0,k.jsx)(P,{isOpen:!!S,onSongSelect:(e,t)=>{m&&t&&z.onReplace(S,t),_(0)},onCancel:()=>_(0)}),(0,k.jsxs)("div",{className:F.cardCenter,children:[r&&(0,k.jsx)(N,{player:r,type:R.Ban,onRemove:null==z?void 0:z.onReset}),d&&(0,k.jsx)(N,{player:d,type:R.Protect,onRemove:null==z?void 0:z.onReset}),p&&(0,k.jsx)(N,{player:p,type:R.Pocket,onRemove:null==z?void 0:z.onReset}),f&&(0,k.jsx)(N,{player:f,type:R.Winner,onRemove:()=>null==z?void 0:z.onSetWinner(null)}),(0,k.jsx)("div",{className:F.name,title:y,children:j}),T?null:(0,k.jsx)("div",{className:F.nameTranslation,children:y}),(0,k.jsx)("div",{className:F.artist,title:w,children:b})]}),(0,k.jsx)(c.J,{content:O,isOpen:C,onClose:()=>v(!1),placement:"top",modifiers:{offset:{options:{offset:[0,35]}}},children:(0,k.jsxs)("div",{className:F.cardFooter,style:{backgroundColor:W},children:[(0,k.jsx)("div",{className:F.bpm,children:t.startsWith("maimai")?-1!==n.flags.findIndex((e=>"std"===e))?"ST":"DX":null}),(0,k.jsx)("div",{className:F.difficulty,children:"".concat(I," ").concat((0,u.aI)(A)," ").concat(E?" (".concat(E.toFixed(1),")"):"")})]})})]})}}}]);
//# sourceMappingURL=421.21ac6.js.map